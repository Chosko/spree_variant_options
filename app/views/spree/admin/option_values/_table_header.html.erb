<script>
$(document).ready(function(){
    // Warning, there should be a better way of doing this:
    // We unbind the click event, and reassign it to a custom one.
    // We do this because we need to clear the 'preview' box when a new row is copied to the table.
    
    $('.spree_add_fields').unbind("click");
    
    // function is called on click while adding new fiels in a form
    $('.spree_add_fields').click(function() {
      var target = $(this).data("target");
      var new_table_row = $(target + ' tr:visible:last').clone();
      var new_id = new Date().getTime();
      new_table_row.find("input").each(function () {
        var el = $(this);
        el.val("");
        el.attr("id", el.attr("id").replace(/\d+/, new_id))
        el.attr("name", el.attr("name").replace(/\d+/, new_id))
      })
      // When cloning a new row, set the href of all icons to be an empty "#"
      // This is so that clicking on them does not perform the actions for the
      // duplicated row
      new_table_row.find("a").each(function () {
        var el = $(this);
        el.attr('href', '#');
      })
      
      // We need to add this line to clear the "preview" box.
      new_table_row.find('.preview').empty();
      
      $(target).prepend(new_table_row);
      
    });
});
</script>

<thead data-hook="option_header">
  <tr>
    <th colspan="2"><%= Spree.t(:name) %></th>
    <th><%= Spree.t(:display) %></th>
    <th><%= Spree.t(:preview) %></th>
    <th><%= Spree.t(:color_code) %></th>
    <!-- <th><%#= Spree.t(:image) %></th> -->
    <th class="actions"></th>
  </tr>
</thead>
